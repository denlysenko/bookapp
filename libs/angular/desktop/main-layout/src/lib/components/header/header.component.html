<mat-toolbar [class.is-mobile]="isMobile()">
  <button mat-icon-button class="menu-toggler" (click)="doToggleSidenav()">
    <i class="material-icons">menu</i>
  </button>
  <a [routerLink]="['/']" class="brand">
    <i class="material-icons">book</i>
    <span>{{ title }}</span>
  </a>

  @if (user(); as user) {
    <div class="user-menu">
      <button
        matIconButton
        class="theme-switcher"
        matTooltip="Switch Theme"
        [matMenuTriggerFor]="themes"
      >
        @switch (themeMode()) {
          @case ('auto') {
            <mat-icon>brightness_medium</mat-icon>
          }

          @case ('light') {
            <mat-icon>light_mode</mat-icon>
          }

          @case ('dark') {
            <mat-icon>dark_mode</mat-icon>
          }
        }
      </button>

      <mat-menu #themes="matMenu">
        <button
          mat-menu-item
          [class.active]="themeMode() === 'auto'"
          (click)="toggleMode.emit('auto')"
          data-testid="system-theme"
        >
          <mat-icon>brightness_medium</mat-icon>
          <span>System</span>
        </button>

        <button
          mat-menu-item
          [class.active]="themeMode() === 'light'"
          (click)="toggleMode.emit('light')"
          data-testid="light-theme"
        >
          <mat-icon>light_mode</mat-icon>
          <span>Light</span>
        </button>

        <button
          mat-menu-item
          [class.active]="themeMode() === 'dark'"
          (click)="toggleMode.emit('dark')"
          data-testid="dark-theme"
        >
          <mat-icon>dark_mode</mat-icon>
          <span>Dark</span>
        </button>
      </mat-menu>

      <button matButton id="user-menu-toggler" [matMenuTriggerFor]="menu">
        <img
          class="avatar"
          [src]="user.avatar ? user.avatar : '/assets/images/no-avatar.svg'"
          alt="avatar"
        />
        <i class="material-icons">expand_more</i>
      </button>

      <mat-menu #menu="matMenu">
        <span mat-menu-item>{{ user.displayName }}</span>

        <mat-divider />

        @for (item of userMenu; track item.path) {
          <a mat-menu-item [routerLink]="['/', item.path]" routerLinkActive="active">
            <mat-icon>{{ item.icon }}</mat-icon>
            <span>{{ item.label }}</span>
          </a>
        }

        <mat-divider />

        <button mat-menu-item id="logout" type="button" (click)="doLogout()">
          <mat-icon>logout</mat-icon>
          <span>Signout</span>
        </button>
      </mat-menu>
    </div>
  }
</mat-toolbar>
